function distance(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}function crossSum(a,b){let sum=a+b;while(sum>9){sum=sum.toString().split("").reduce((acc,d)=>acc+parseInt(d),0)}return sum}function applySpringPhysics(d,targetX,targetY,spring,damp,maxSpeed,offset=0){if(offset){targetX+=(Math.random()-.5)*offset;targetY+=(Math.random()-.5)*offset}d.dx+=(targetX-d.x)*spring;d.dy+=(targetY-d.y)*spring;d.dx*=damp;d.dy*=damp;const speed=Math.hypot(d.dx,d.dy);if(speed>maxSpeed){d.dx=d.dx/speed*maxSpeed;d.dy=d.dy/speed*maxSpeed}}function log(...messages){if(window.DEV)console.log(...messages)}function showConfig(){log("=== CONFIG PARAMETERS ===");for(const key of Object.keys(CONFIG)){if(key.startsWith("_"))continue;const value=CONFIG[key];if(typeof value!=="function")log(key,":",value)}log("========================")}function moduleTag(meta){const parts=meta.url.split("/");return parts.slice(-2).join("/")}log(`[${moduleTag(import.meta)}] loaded`);function createCountsObject(){return{M:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},F:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}}}const state={digits:[],tick:0,resetCount:0,resetStartTime:Date.now(),allTimeTotal:0,rawTotalValue:0,running:false,paused:false,animationFrameId:null,currentCounts:createCountsObject(),epochCumulativeCounts:createCountsObject()};log(`[${moduleTag(import.meta)}] loaded`);let _FPS=60;let _POP_CAP=48;const CONFIG$1={_speed:3,get speed(){return this._speed??Math.min(Math.max(window.innerWidth/500,2),5)},set speed(value){this._speed=value;this.updateDerivedFrames()},_maxAgeSec:20,get maxAgeSec(){return this._maxAgeSec},set maxAgeSec(value){this._maxAgeSec=value;this.updateDerivedFrames()},_attractionRadius:null,get attractionRadius(){return this._attractionRadius??300},set attractionRadius(value){this._attractionRadius=value;this.updateDerivedFrames()},_digitSize:null,get digitSize(){return this._digitSize??Math.min(Math.max(window.innerWidth/15,30),40)},set digitSize(value){this._digitSize=value;document.documentElement.style.setProperty("--digit-size",value+"px")},get POP_CAP(){return _POP_CAP},set POP_CAP(value){const oldCap=_POP_CAP;_POP_CAP=value;if(value<oldCap&&state.digits.length>value){const excess=state.digits.length-value;log(`POP_CAP decreased: aging ${excess} extra digits`);const sorted=[...state.digits].sort((a,b)=>a.age-b.age);for(let i=0;i<excess;i++){sorted[i].age=CONFIG$1.oldAge}}log(`POP_CAP updated to ${value}`)},get FPS(){return _FPS},set FPS(value){_FPS=value;this.updateDerivedFrames()},_juvenileAgeSec:null,get juvenileAgeSec(){return this._juvenileAgeSec??this.maxAgeSec/8},set juvenileAgeSec(value){this._juvenileAgeSec=value;this.updateDerivedFrames()},_adolescenceAgeSec:null,get adolescenceAgeSec(){return this._adolescenceAgeSec??this.maxAgeSec/5},set adolescenceAgeSec(value){this._adolescenceAgeSec=value;this.updateDerivedFrames()},_matureAgeSec:null,get matureAgeSec(){return this._matureAgeSec??this.maxAgeSec/4},set matureAgeSec(value){this._matureAgeSec=value;this.updateDerivedFrames()},_oldAgeSec:null,get oldAgeSec(){return this._oldAgeSec??this.maxAgeSec-this.maxAgeSec/5},set oldAgeSec(value){this._oldAgeSec=value;this.updateDerivedFrames()},velocityJitter:1,directionJitter:.3,jitterYoung:.4,jitterOld:.2,_reproCooldownSec:null,get reproCooldownSec(){return this._reproCooldownSec??this.maxAgeSec/8},set reproCooldownSec(value){this._reproCooldownSec=value;this.updateDerivedFrames()},_mateDistance:null,get mateDistance(){return this._mateDistance??60},set mateDistance(value){this._mateDistance=value;this.updateDerivedFrames()},_gestationSec:null,get gestationSec(){return this._gestationSec??this.maxAgeSec/20},set gestationSec(value){this._gestationSec=value;this.updateDerivedFrames()},bondedOffset:50,newbornSpeedFactor:1,newbornOffset:2,enableAttractor:false,attractorRadius:250,attractorStrength:.2,showAttractorLines:true,springK:.09,springDamping:.6,bondedJitter:.9,updateDerivedFrames(){this.maxAge=this.maxAgeSec*this.FPS;this.juvenileAge=this.juvenileAgeSec*this.FPS;this.adolescenceAge=this.adolescenceAgeSec*this.FPS;this.matureAge=this.matureAgeSec*this.FPS;this.oldAge=this.oldAgeSec*this.FPS;this.reproCooldown=this.reproCooldownSec*this.FPS;this.gestation=this.gestationSec*this.FPS}};CONFIG$1.updateDerivedFrames();document.documentElement.style.setProperty("--digit-size",CONFIG$1.digitSize+"px");if(window.DEV){window.CONFIG=CONFIG$1;window.showConfig=showConfig}log(`[${moduleTag(import.meta)}] loaded`);const GLOBE_SETTINGS={lightAngle:Math.PI/4,lightDistance:.3,highlight:.4,shadow:.4};const OUTLINE_SETTINGS={maxAlpha:.8,baseWidth:.5};const GLOW_SETTINGS={strength:20,opacity:.9};const BLUR_SETTINGS={maxBlur:4};const SEARCH_RADIUS_SETTINGS={color:"rgba(0,0,255,0.15)",lineWidth:1,fillOpacity:.05};const BOND_LINE_SETTINGS={color:"rgba(0,200,0,0.5)",lineWidth:2};const CHILD_BOND_LINE_SETTINGS={baseColor:[255,165,0],lineWidth:1.5};const ATTRACTION_LINE_SETTINGS={maleToFemale:{color:"rgba(255,255,255,0.7)",width:1}};let canvas$2,ctx$2;function updateDigitAppearance(d){const scale=.3+Math.min(d.age/CONFIG$1.matureAge,1)*.7;const opacity=d.age<CONFIG$1.oldAge?1:1-(d.age-CONFIG$1.oldAge)/(CONFIG$1.maxAge-CONFIG$1.oldAge);const t=Math.min(d.age/CONFIG$1.matureAge,1);let r,g,b;if(d.sex==="M"){r=255+t*(100-255)|0;g=255+t*(160-255)|0;b=255}else{r=255;g=255+t*(100-255)|0;b=255+t*(100-255)|0}const baseColor=`rgb(${r},${g},${b})`;const lighten=c=>Math.min(255,c+255*GLOBE_SETTINGS.highlight);const darken=c=>Math.max(0,c*(1-GLOBE_SETTINGS.shadow));const highlight=`rgb(${lighten(r)},${lighten(g)},${lighten(b)})`;const shadow=`rgb(${darken(r)},${darken(g)},${darken(b)})`;const outlineColor=`rgba(0,0,0,${Math.min(opacity,OUTLINE_SETTINGS.maxAlpha)})`;const outlineWidth=OUTLINE_SETTINGS.baseWidth+scale*.5;const speed=Math.hypot(d.dx||0,d.dy||0);const blur=Math.min(speed/CONFIG$1.speed,1)*BLUR_SETTINGS.maxBlur;const lx=d.x-Math.cos(GLOBE_SETTINGS.lightAngle)*GLOBE_SETTINGS.lightDistance*CONFIG$1.digitSize*scale;const ly=d.y-Math.sin(GLOBE_SETTINGS.lightAngle)*GLOBE_SETTINGS.lightDistance*CONFIG$1.digitSize*scale;return{scale:scale,color:baseColor,opacity:opacity,highlight:highlight,shadow:shadow,outlineColor:outlineColor,outlineWidth:outlineWidth,blur:blur,lx:lx,ly:ly}}function initCanvasRenderer(){canvas$2=document.getElementById("dslCanvas");if(!canvas$2)throw new Error("Canvas element not found: #dslCanvas");ctx$2=canvas$2.getContext("2d");return{canvas:canvas$2,ctx:ctx$2}}function renderDigit(d,activeSet){const props=updateDigitAppearance(d);const size=CONFIG$1.digitSize*props.scale;ctx$2.save();ctx$2.globalAlpha=props.opacity;ctx$2.shadowBlur=0;ctx$2.shadowOffsetX=0;ctx$2.shadowOffsetY=0;{ctx$2.shadowColor=`rgba(${props.color.match(/\d+/g).join(",")},${GLOW_SETTINGS.opacity})`;ctx$2.shadowBlur=GLOW_SETTINGS.strength}ctx$2.beginPath();{const g=ctx$2.createRadialGradient(props.lx,props.ly,size*.1,d.x,d.y,size/2);g.addColorStop(0,props.highlight);g.addColorStop(.3,props.color);g.addColorStop(1,props.shadow);ctx$2.fillStyle=g}ctx$2.arc(d.x,d.y,size/2,0,Math.PI*2);ctx$2.fill();ctx$2.closePath();ctx$2.shadowBlur=0;ctx$2.shadowOffsetX=0;ctx$2.shadowOffsetY=0;{ctx$2.lineWidth=props.outlineWidth;ctx$2.strokeStyle=props.outlineColor;ctx$2.stroke()}ctx$2.fillStyle="#000";ctx$2.font=`${size*.6}px sans-serif`;ctx$2.textAlign="center";ctx$2.textBaseline="middle";ctx$2.fillText(d.name,d.x,d.y);ctx$2.restore();if(d.sex==="M"&&d.age>=CONFIG$1.matureAge){ctx$2.save();ctx$2.fillStyle=`rgba(0,0,255,${SEARCH_RADIUS_SETTINGS.fillOpacity})`;ctx$2.strokeStyle=SEARCH_RADIUS_SETTINGS.color;ctx$2.lineWidth=SEARCH_RADIUS_SETTINGS.lineWidth;ctx$2.beginPath();ctx$2.arc(d.x,d.y,CONFIG$1.attractionRadius,0,Math.PI*2);ctx$2.fill();ctx$2.stroke();ctx$2.closePath();ctx$2.restore()}if(d.sex==="M"&&d.age>=CONFIG$1.matureAge&&d.age<CONFIG$1.oldAge&&d.attractionTarget){const target=d.attractionTarget;const validTarget=target&&activeSet.has(target)&&target.sex==="F"&&target.age>=CONFIG$1.matureAge&&target.age<CONFIG$1.oldAge&&target.gestationTimer===0&&!target.bondedTo;if(validTarget){ctx$2.save();ctx$2.strokeStyle=ATTRACTION_LINE_SETTINGS.maleToFemale.color;ctx$2.lineWidth=ATTRACTION_LINE_SETTINGS.maleToFemale.width;ctx$2.beginPath();ctx$2.moveTo(d.x,d.y);ctx$2.lineTo(target.x,target.y);ctx$2.stroke();ctx$2.restore()}}}function renderBonds(digits){if(!ctx$2)return;ctx$2.save();ctx$2.lineCap="round";const activeDigits=digits.filter(d=>d);const activeSet=new Set(activeDigits);for(const d of activeDigits){if(d.bondedTo&&activeSet.has(d.bondedTo)){const other=d.bondedTo;const fade1=d.age<CONFIG$1.oldAge?1:1-(d.age-CONFIG$1.oldAge)/(CONFIG$1.maxAge-CONFIG$1.oldAge);const fade2=other.age<CONFIG$1.oldAge?1:1-(other.age-CONFIG$1.oldAge)/(CONFIG$1.maxAge-CONFIG$1.oldAge);const alpha=Math.min(fade1,fade2);ctx$2.strokeStyle=BOND_LINE_SETTINGS.color.replace(/[\d.]+\)$/g,`${alpha})`);ctx$2.lineWidth=BOND_LINE_SETTINGS.lineWidth;ctx$2.beginPath();ctx$2.moveTo(d.x,d.y);ctx$2.lineTo(other.x,other.y);ctx$2.stroke()}if(d.mother&&activeSet.has(d.mother)&&d.age<CONFIG$1.adolescenceAge){const fade=1-d.age/CONFIG$1.adolescenceAge;ctx$2.strokeStyle=`rgba(${CHILD_BOND_LINE_SETTINGS.baseColor.join(",")},${fade})`;ctx$2.lineWidth=CHILD_BOND_LINE_SETTINGS.lineWidth;ctx$2.beginPath();ctx$2.moveTo(d.x,d.y);ctx$2.lineTo(d.mother.x,d.mother.y);ctx$2.stroke()}}ctx$2.restore()}function renderAll(digits){if(!ctx$2)return;ctx$2.clearRect(0,0,canvas$2.width,canvas$2.height);const activeSet=new Set(digits.filter(d=>d));for(const d of digits)if(d)renderDigit(d,activeSet);renderBonds(digits)}log(`[${moduleTag(import.meta)}] loaded (render module)`);function updateDigitPosition(d){let moved=false;if(d.mother&&d.age<CONFIG$1.adolescenceAge){if(!d.target)d.target={x:d.x,y:d.y};if(!d.orbitAngle)d.orbitAngle=Math.random()*Math.PI*2;d.orbitAngle+=.01;const radius=CONFIG$1.bondedOffset*(.8+Math.random()*.2);d.target.x=d.mother.x+Math.cos(d.orbitAngle)*radius;d.target.y=d.mother.y+Math.sin(d.orbitAngle)*radius;applySpringPhysics(d,d.target.x,d.target.y,CONFIG$1.springK,CONFIG$1.springDamping,CONFIG$1.speed*CONFIG$1.bondedJitter);d.dx+=(Math.random()-.5)*.1;d.dy+=(Math.random()-.5)*.1;moved=true}else if(d.sex==="M"&&d.bondedTo){if(!d.target)d.target={x:d.x,y:d.y};if(!d.orbitAngle)d.orbitAngle=Math.random()*Math.PI*2;d.orbitAngle+=.008;const radius=CONFIG$1.bondedOffset*(.85+Math.random()*.15);d.target.x=d.bondedTo.x+Math.cos(d.orbitAngle)*radius;d.target.y=d.bondedTo.y+Math.sin(d.orbitAngle)*radius;applySpringPhysics(d,d.target.x,d.target.y,CONFIG$1.springK,CONFIG$1.springDamping,CONFIG$1.speed*CONFIG$1.bondedJitter);moved=true}else if(d.sex==="M"&&d.age>=CONFIG$1.matureAge&&d.age<CONFIG$1.oldAge){const targetFemale=nearestFemale(d);if(targetFemale){const dist=distance(d,targetFemale);if(dist<=CONFIG$1.mateDistance&&!d.bondedTo&&targetFemale.gestationTimer===0){bondPair(d,targetFemale)}if(!d.target)d.target={x:d.x,y:d.y};d.target.x=targetFemale.x;d.target.y=targetFemale.y;seekTarget(d,d.target,dist);d.attractionTarget=targetFemale}else{d.attractionTarget=null}}if(!moved){applyJitter(d)}clampVelocity(d,CONFIG$1.speed);updatePosition(d);bounceOffWalls(d)}function nearestFemale(male){let minDist=CONFIG$1.attractionRadius;let closest=null;for(const f of state.digits){if(f.sex!=="F"||f.age<CONFIG$1.matureAge||f.age>=CONFIG$1.oldAge||f.gestationTimer>0||f.bondedTo)continue;const dist=distance(male,f);if(dist<minDist){minDist=dist;closest=f}}return closest}function seekTarget(d,target,dist){const targetAngle=Math.atan2(target.y-d.y,target.x-d.x);const currentAngle=Math.atan2(d.dy,d.dx);let blend=.08;let speedFactor=.7;if(d.sex==="M"&&!d.bondedTo&&target.gestationTimer===0){blend=.15;speedFactor=1}const angle=currentAngle*(1-blend)+targetAngle*blend;const approachFactor=Math.min(dist/CONFIG$1.attractionRadius,1);const speed=CONFIG$1.speed*speedFactor*approachFactor;d.dx=Math.cos(angle)*speed;d.dy=Math.sin(angle)*speed}function bondPair(male,female){male.bondedTo=female;female.bondedTo=male;female.gestationTimer=CONFIG$1.gestation}function applyJitter(d){const ageRatio=d.age/CONFIG$1.maxAge;const jitterScale=ageRatio<.3?CONFIG$1.jitterYoung:ageRatio<.7?1:CONFIG$1.jitterOld;const angle=Math.atan2(d.dy,d.dx)+(Math.random()-.5)*CONFIG$1.directionJitter*jitterScale;const jitter=(Math.random()-.5)*CONFIG$1.velocityJitter*jitterScale;const baseSpeed=CONFIG$1.speed*.2;const speed=Math.max(baseSpeed,Math.min(CONFIG$1.speed*(1+jitter),CONFIG$1.speed*1.2));d.dx=Math.cos(angle)*speed;d.dy=Math.sin(angle)*speed}function clampVelocity(d,maxSpeed){const mag=Math.hypot(d.dx,d.dy);if(mag>maxSpeed){d.dx=d.dx/mag*maxSpeed;d.dy=d.dy/mag*maxSpeed}}function updatePosition(d){d.x+=d.dx;d.y+=d.dy}function bounceOffWalls(d){const margin=5;const{scale:scale}=updateDigitAppearance(d);const radius=CONFIG$1.digitSize*scale/2;const bounds={left:radius+margin,right:window.innerWidth-radius-margin,top:40+radius+margin,bottom:window.innerHeight-radius-margin};if(d.x<bounds.left){d.x=bounds.left;d.dx*=-.8}else if(d.x>bounds.right){d.x=bounds.right;d.dx*=-.8}if(d.y<bounds.top){d.y=bounds.top;d.dy*=-.8}else if(d.y>bounds.bottom){d.y=bounds.bottom;d.dy*=-.8}}log(`[${moduleTag(import.meta)}] loaded`);console.log("CONFIG in digit.js");function createDigit(name,sex,x,y,speedFactor=1,mother,father){const angle=Math.random()*2*Math.PI;const digit={name:name,sex:sex,x:x,y:y,dx:mother?0:Math.cos(angle)*CONFIG$1.speed*speedFactor,dy:mother?0:Math.sin(angle)*CONFIG$1.speed*speedFactor,age:0,lastRepro:-Infinity,element:null,bondedTo:null,gestationTimer:0,mother:mother,father:father,attractedZero:false};updateDigitPosition(digit);updateDigitAppearance(digit);state.digits.push(digit);state.currentCounts[sex][name]++;state.epochCumulativeCounts[sex][name]++;state.allTimeTotal+=parseInt(name);return digit}function killDigit(d){state.currentCounts[d.sex][d.name]=Math.max(0,state.currentCounts[d.sex][d.name]-1);if(d.element)d.element.remove();state.digits=state.digits.filter(x=>x!==d)}log(`[${moduleTag(import.meta)}] loaded`);function reproduce(){if(state.digits.length>=CONFIG$1.POP_CAP)return;for(const f of state.digits){if(f.sex==="F"&&f.gestationTimer>0){f.gestationTimer--;if(f.gestationTimer===0&&f.bondedTo){const m=f.bondedTo;const name=crossSum(parseInt(f.name),parseInt(m.name)).toString();const sex=Math.random()<.5?"M":"F";const x=(f.x+m.x)/2+(Math.random()-.5)*CONFIG$1.newbornOffset;const y=(f.y+m.y)/2+(Math.random()-.5)*CONFIG$1.newbornOffset;createDigit(name,sex,x,y,CONFIG$1.newbornSpeedFactor,f,m);f.lastRepro=state.tick;m.lastRepro=state.tick;f.bondedTo=null;m.bondedTo=null}}}}log(`[${moduleTag(import.meta)}] loaded`);const STATS_CONFIG=[{id:"epoch",label:"Epoch",value:()=>state.resetCount+1},{id:"elapsed",label:"Elapsed Time",value:()=>((Date.now()-state.resetStartTime)/1e3).toFixed(1)+"s"},{id:"current",label:"Current Value",value:()=>{let total=0;for(const d of state.digits)total=crossSum(total,parseInt(d.name));return total}},{id:"epochTotal",label:"Epoch Total Value",value:()=>{let epochTotal=0;for(let n=1;n<=9;n++){const digit=n.toString();const count=(state.epochCumulativeCounts.M[digit]||0)+(state.epochCumulativeCounts.F[digit]||0);for(let i=0;i<count;i++){epochTotal=crossSum(epochTotal,parseInt(digit))}}return epochTotal}}];function initStatsBar(){const container=document.getElementById("statsBarContent");if(!container)return;container.innerHTML="";STATS_CONFIG.forEach(({id:id,label:label})=>{const item=document.createElement("div");item.className="statsbar-item";item.id=`stat-${id}`;item.innerHTML=`\n      <div class="statsbar-item-label">${label}</div>\n      <div class="statsbar-item-value">–</div>\n    `;container.appendChild(item)})}function updateStatsBar(){STATS_CONFIG.forEach(({id:id,value:value})=>{const valueEl=document.querySelector(`#stat-${id} .statsbar-item-value`);if(!valueEl)return;try{const newValue=value();valueEl.textContent=newValue??"–"}catch(err){console.warn(`⚠️ Error updating stat "${id}":`,err);valueEl.textContent="–"}})}function updateStatsTable(){const tbody=document.querySelector("#statsTable tbody");if(!tbody)return;tbody.innerHTML="";const rows=[];let maxCurrent=0,maxCumulative=0;const totals={mCur:0,fCur:0,mCum:0,fCum:0};for(let n=1;n<=9;n++){const digit=n.toString();const mCur=state.currentCounts.M[digit]||0;const fCur=state.currentCounts.F[digit]||0;const mCum=state.epochCumulativeCounts.M[digit]||0;const fCum=state.epochCumulativeCounts.F[digit]||0;rows.push({digit:digit,mCur:mCur,fCur:fCur,mCum:mCum,fCum:fCum});totals.mCur+=mCur;totals.fCur+=fCur;totals.mCum+=mCum;totals.fCum+=fCum;maxCurrent=Math.max(maxCurrent,mCur,fCur);maxCumulative=Math.max(maxCumulative,mCum,fCum)}const getOpacity=(value,max)=>value&&max?.1+value/max*.8:.1;for(const row of rows){const mCurOpacity=getOpacity(row.mCur,maxCurrent);const fCurOpacity=getOpacity(row.fCur,maxCurrent);const mCumOpacity=getOpacity(row.mCum,maxCumulative);const fCumOpacity=getOpacity(row.fCum,maxCumulative);tbody.innerHTML+=`\n      <tr>\n        <td>${row.digit}</td>\n        <td style="background-color: rgba(100, 160, 255, ${mCurOpacity});">${row.mCur||""}</td>\n        <td style="background-color: rgba(255, 100, 100, ${fCurOpacity});">${row.fCur||""}</td>\n        <td><strong>${row.mCur+row.fCur||""}</strong></td>\n        <td style="background-color: rgba(100, 160, 255, ${mCumOpacity});">${row.mCum||""}</td>\n        <td style="background-color: rgba(255, 100, 100, ${fCumOpacity});">${row.fCum||""}</td>\n        <td><strong>${row.mCum+row.fCum||""}</strong></td>\n      </tr>\n    `}tbody.innerHTML+=`\n    <tr style="font-weight: bold;">\n      <td style="background-color: rgba(200, 200, 200, 0.3);">TOTAL</td>\n      <td style="background-color: rgba(100, 160, 255, 0.5);">${totals.mCur}</td>\n      <td style="background-color: rgba(255, 100, 100, 0.5);">${totals.fCur}</td>\n      <td style="background-color: rgba(220, 220, 220, 0.4); font-size: 1.3em;"><strong>${totals.mCur+totals.fCur}</strong></td>\n      <td style="background-color: rgba(100, 160, 255, 0.5);">${totals.mCum}</td>\n      <td style="background-color: rgba(255, 100, 100, 0.5);">${totals.fCum}</td>\n      <td style="background-color: rgba(220, 220, 220, 0.4); font-size: 1.3em;"><strong>${totals.mCum+totals.fCum}</strong></td>\n    </tr>\n  `}let graph=null;function graphValue(){let rawTotalValue=0;state.digits.length;for(const d of state.digits){const value=parseInt(d.name)||0;rawTotalValue+=value}state.rawTotalValue=rawTotalValue;return rawTotalValue}function initGraph(){const canvas=document.getElementById("graphCanvas");if(!canvas){log("Graph canvas not yet available — will initialize later.");return false}graph={data:[],maxPoints:200,updateCounter:0,updateInterval:5,canvas:canvas,ctx:canvas.getContext("2d")};return true}function updateGraph(){if(!graph){if(!initGraph())return}let valueToGraph=graphValue();graph.updateCounter++;if(graph.updateCounter>=graph.updateInterval){graph.data.push(valueToGraph);if(graph.data.length>graph.maxPoints)graph.data.shift();graph.updateCounter=0}drawGraph()}function drawGraph(){if(!graph)return;const{canvas:canvas,ctx:ctx,data:data}=graph;const{width:width,height:height}=canvas;ctx.clearRect(0,0,width,height);if(data.length<2)return;const maxValue=Math.max(...data,10);const range=maxValue;ctx.strokeStyle="#e0e0e0";ctx.lineWidth=1;for(let i=0;i<=5;i++){const y=(height-20)*(i/5)+10;ctx.beginPath();ctx.moveTo(30,y);ctx.lineTo(width-10,y);ctx.stroke()}ctx.fillStyle="black";ctx.font="10px sans-serif";ctx.textAlign="right";for(let i=0;i<=5;i++){const y=(height-20)*(i/5)+10;const value=Math.round(maxValue-range*i/5);ctx.fillText(value,25,y+3)}ctx.strokeStyle="#2196F3";ctx.lineWidth=2;ctx.beginPath();const pointSpacing=(width-40)/(graph.maxPoints-1);for(let i=0;i<data.length;i++){const x=30+i*pointSpacing;const y=height-10-data[i]/range*(height-20);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)}ctx.stroke();if(data.length>0){ctx.fillStyle="black";ctx.font="bold 12px sans-serif";ctx.textAlign="left";ctx.fillText(`Current: ${data[data.length-1]}`,35,20)}}initGraph();initStatsBar();function updateStats(){updateStatsBar?.();updateStatsTable?.();updateGraph?.()}log(`[${moduleTag(import.meta)}] loaded`);let attractorDebugCtx;if(CONFIG$1.showAttractorLines){const c=document.createElement("canvas");c.style.position="fixed";c.style.left=0;c.style.top=0;c.style.pointerEvents="none";c.width=window.innerWidth;c.height=window.innerHeight;c.style.zIndex=9999;attractorDebugCtx=c.getContext("2d");document.body.appendChild(c);window.addEventListener("resize",()=>{c.width=window.innerWidth;c.height=window.innerHeight})}let attractor=null;let attractorEl=null;function initAttractor(){log("Initializing attractor...");if(!CONFIG$1.enableAttractor)return;attractorEl=document.createElement("div");Object.assign(attractorEl.style,{position:"fixed",width:CONFIG$1.digitSize+"px",height:CONFIG$1.digitSize+"px",borderRadius:"50%",color:"white",fontSize:CONFIG$1.digitSize+"px",fontWeight:"bold",textAlign:"center",lineHeight:CONFIG$1.digitSize+"px",pointerEvents:"none",display:"none",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none"});attractorEl.innerText="0";document.body.appendChild(attractorEl);attractorEl.addEventListener("contextmenu",e=>e.preventDefault());const updateAttractor=(x,y)=>{attractor={x:x,y:y};attractorEl.style.display="block";attractorEl.style.left=x-CONFIG$1.digitSize/2+"px";attractorEl.style.top=y-CONFIG$1.digitSize/2+"px"};document.addEventListener("mousedown",e=>{updateAttractor(e.clientX,e.clientY)});document.addEventListener("mousemove",e=>attractor&&updateAttractor(e.clientX,e.clientY));document.addEventListener("mouseup",()=>{attractor=null;attractorEl.style.display="none"});document.addEventListener("touchstart",e=>{const touch=e.touches[0];updateAttractor(touch.clientX,touch.clientY)});document.addEventListener("touchmove",e=>{const touch=e.touches[0];if(attractor)updateAttractor(touch.clientX,touch.clientY)});document.addEventListener("touchend",()=>{attractor=null;attractorEl.style.display="none"})}function applyAttractor(digit){if(!CONFIG$1.enableAttractor||!attractor)return;if(digit.attractedZero)return;const dx=attractor.x-digit.x;const dy=attractor.y-digit.y;const dist=Math.sqrt(dx*dx+dy*dy);const radius=CONFIG$1.attractionRadius||150;const strength=CONFIG$1.attractorStrength||.05;if(dist<radius){const force=(radius-dist)/radius;digit.dx+=dx*force*strength;digit.dy+=dy*force*strength;if(CONFIG$1.showAttractorLines&&attractorDebugCtx){attractorDebugCtx.beginPath();attractorDebugCtx.moveTo(digit.x,digit.y);attractorDebugCtx.lineTo(attractor.x,attractor.y);attractorDebugCtx.strokeStyle="rgba(0,255,0,0.1)";attractorDebugCtx.stroke()}if(dist<20){digit.name="0";digit.attractedZero=true}}}log(`[${moduleTag(import.meta)}] loaded`);let canvas$1,ctx$1;function initSimulationCanvas(){canvas$1=document.getElementById("dslCanvas");if(!canvas$1)throw new Error("Canvas element not found: #dslCanvas");ctx$1=canvas$1.getContext("2d");return{canvas:canvas$1,ctx:ctx$1}}function initStartingDigits(){const cx=window.innerWidth/2;const cy=window.innerHeight/2;const d1=createDigit("1","M",cx-30,cy);const d2=createDigit("1","F",cx+30,cy);[d1,d2].forEach(d=>{const angle=Math.random()*2*Math.PI;const speed=Math.max(CONFIG$1.speed,.5);d.dx=Math.cos(angle)*speed;d.dy=Math.sin(angle)*speed;d.followTimer=0});requestAnimationFrame(()=>startSimulation())}function resetSimulation(){state.digits=[];initStartingDigits();state.resetStartTime=Date.now();state.epochCumulativeCounts=createCountsObject()}let lastTime=performance.now();function tickSimulation(now=performance.now()){if(!state.paused){const deltaTime=(now-lastTime)/1e3;lastTime=now;const frameIncrement=deltaTime*CONFIG$1.FPS;if(CONFIG$1.showAttractorLines&&attractorDebugCtx){attractorDebugCtx.clearRect(0,0,attractorDebugCtx.canvas.width,attractorDebugCtx.canvas.height)}for(const d of[...state.digits]){d.age+=frameIncrement;updateDigitPosition(d);if(CONFIG$1.enableAttractor){applyAttractor(d)}if(d.age>CONFIG$1.maxAge)killDigit(d)}reproduce();if(state.digits.length===0)resetSimulation();updateStats();renderAll(state.digits)}if(state.running){state.animationFrameId=requestAnimationFrame(tickSimulation)}}function startSimulation(){if(!state.running){state.running=true;state.paused=false;if(state.digits.length===0)resetSimulation();tickSimulation()}}function stopSimulation(){state.running=false;state.paused=false;if(state.animationFrameId){cancelAnimationFrame(state.animationFrameId);state.animationFrameId=null}}log(`[${moduleTag(import.meta)}] loaded`);class ParameterManager{constructor(){this.sliders=new Map;this.container=null;this.initialized=false}init(){if(this.initialized)return;this.container=document.getElementById("paramSlidersContainer");if(!this.container){console.warn("Parameter sliders container not found yet, retrying...");return false}this.initialized=true;log(`[${moduleTag(import.meta)}] loaded`);return true}addSlider(SLIDERCONFIG){if(!this.initialized){console.error("Parameter manager not initialized. Call init() after DOM ready.");return}const{id:id,label:label,target:target,property:property,min:min,max:max,step:step=1,onChange:onChange=null,format:format=null}=SLIDERCONFIG;if(this.sliders.has(id)){console.warn(`Slider with id "${id}" already exists`);return}const currentValue=target[property];const formatValue=format||(v=>v);const sliderWrapper=document.createElement("div");sliderWrapper.className="param-slider-wrapper";sliderWrapper.dataset.sliderId=id;sliderWrapper.innerHTML=`\n            <div class="param-slider-label">${label}</div>\n            <div class="param-slider-value" id="paramValue-${id}">${formatValue(currentValue)}</div>\n            <div class="param-slider-track">\n                <input \n                    type="range" \n                    id="paramSlider-${id}"\n                    class="param-slider"\n                    min="${min}"\n                    max="${max}"\n                    step="${step}"\n                    value="${currentValue}"\n                />\n            </div>\n            <div class="param-slider-range">${min} - ${max}</div>\n        `;this.container.appendChild(sliderWrapper);const slider=document.getElementById(`paramSlider-${id}`);const valueDisplay=document.getElementById(`paramValue-${id}`);this.sliders.set(id,{element:slider,valueDisplay:valueDisplay,wrapper:sliderWrapper,target:target,property:property,format:formatValue,onChange:onChange});slider.addEventListener("input",e=>{const value=parseFloat(e.target.value);target[property]=value;valueDisplay.textContent=formatValue(value);if(onChange)onChange(value)});log(`Added slider: ${id}`)}updateValue(id,value){const sliderData=this.sliders.get(id);if(!sliderData)return;sliderData.element.value=value;sliderData.target[sliderData.property]=value;sliderData.valueDisplay.textContent=sliderData.format(value)}getValue(id){const sliderData=this.sliders.get(id);return sliderData?parseFloat(sliderData.element.value):null}}const parameterManager=new ParameterManager;function initializeParameters(){if(!parameterManager.init()){requestAnimationFrame(initializeParameters);return}parameterManager.addSlider({id:"speed",label:"Speed",target:CONFIG$1,property:"speed",min:1,max:10,step:.1});parameterManager.addSlider({id:"maxAgeSec",label:"Max Age",target:CONFIG$1,property:"maxAgeSec",min:5,max:50,step:1});parameterManager.addSlider({id:"searchRadius",label:"Search Radius",target:CONFIG$1,property:"attractionRadius",min:100,max:500,step:10});parameterManager.addSlider({id:"digitSize",label:"Digit Size",target:CONFIG$1,property:"digitSize",min:20,max:80,step:1});parameterManager.addSlider({id:"POP_CAP",label:"Population Cap",target:CONFIG$1,property:"POP_CAP",min:12,max:144,step:12})}function loadModals(){return new Promise(resolve=>{const modalsContainer=document.getElementById("modalsContainer");if(!modalsContainer)return resolve();fetch("/run/modals.html").then(res=>{if(!res.ok)throw new Error("Failed to load modals");return res.text()}).then(html=>{modalsContainer.innerHTML=html;resolve()}).catch(err=>{console.error(err);modalsContainer.innerHTML=`<p>Error loading modals.</p>`;resolve()})})}function loadAboutText(){return new Promise(resolve=>{const aboutContainer=document.getElementById("aboutContent");if(!aboutContainer)return resolve();fetch("/about.html").then(res=>{if(!res.ok)throw new Error("Failed to load about text");return res.text()}).then(html=>{aboutContainer.innerHTML=html;resolve()}).catch(err=>{console.error(err);aboutContainer.innerHTML=`<p>Error loading about text.</p>`;resolve()})})}let topZIndex=1e4;function bringToFront(modal){modal.style.zIndex=++topZIndex}function toggleModal(id,show){const modal=document.getElementById(id);const overlay=document.getElementById(id.replace("Modal","Overlay"));if(modal){modal.style.display=show?"flex":"none";if(show)bringToFront(modal)}if(overlay)overlay.style.display=show?"block":"none"}function makeDraggable(modal,handle){let offsetX=0,offsetY=0;modal.draggingHeader=false;handle.addEventListener("mousedown",e=>{if(e.target.classList.contains("modal-close"))return;modal.draggingHeader=true;const rect=modal.getBoundingClientRect();offsetX=e.clientX-rect.left;offsetY=e.clientY-rect.top;document.addEventListener("mousemove",drag);document.addEventListener("mouseup",stopDrag);bringToFront(modal)});function drag(e){if(!modal.draggingHeader)return;modal.style.left=e.clientX-offsetX+"px";modal.style.top=e.clientY-offsetY+"px"}function stopDrag(){modal.draggingHeader=false;document.removeEventListener("mousemove",drag);document.removeEventListener("mouseup",stopDrag)}}function blockModalClicks(){document.querySelectorAll(".modal-window").forEach(modal=>{modal.addEventListener("click",e=>{if(!modal.draggingHeader){bringToFront(modal);e.stopPropagation()}});modal.addEventListener("mousedown",e=>{if(!modal.draggingHeader)e.stopPropagation()});modal.addEventListener("mouseup",e=>{if(!modal.draggingHeader)e.stopPropagation()})})}function setupModalManager(){document.querySelectorAll('[data-action="openModal"]').forEach(btn=>{btn.addEventListener("click",()=>{toggleModal(btn.dataset.target,true)})});document.querySelectorAll(".modal-close").forEach(btn=>{btn.addEventListener("click",e=>{toggleModal(btn.dataset.modal,false);e.stopPropagation()})});const statsToggle=document.querySelector('[data-action="toggleStatsBar"]');if(statsToggle){statsToggle.addEventListener("click",()=>{const bar=document.getElementById("statsBar");const indicator=document.getElementById("statsBarIndicator");const visible=bar.style.display==="flex";bar.style.display=visible?"none":"flex";indicator.textContent=visible?"OFF":"ON";indicator.style.color=visible?"#666":"#4CAF50"})}document.querySelectorAll(".modal-window").forEach(modal=>{const header=modal.querySelector(".modal-header");if(header)makeDraggable(modal,header)});const menuBtn=document.getElementById("menuBtn");const aboutBtn=document.getElementById("aboutBtn");const pauseBtn=document.getElementById("pauseBtn");const restartBtn=document.getElementById("restartBtn");if(menuBtn)menuBtn.addEventListener("click",()=>toggleModal("menuModal",true));if(aboutBtn)aboutBtn.addEventListener("click",()=>toggleModal("aboutModal",true));if(pauseBtn){pauseBtn.addEventListener("click",function(){state.paused=!state.paused;this.innerHTML=state.paused?"<span class='icon'>▶</span><span class='label'> Resume":"<span class='icon'>⏸</span><span class='label'> Pause";this.classList.toggle("paused",state.paused)})}if(restartBtn){restartBtn.addEventListener("click",()=>{stopSimulation();resetSimulation();updateStats();startSimulation();if(pauseBtn){pauseBtn.textContent="⏸ Pause";pauseBtn.classList.remove("paused")}})}if(isMobile()){const menuDivider=document.getElementById("desktopMenuDivider");if(menuDivider)menuDivider.style.display="none";if(menuBtn)menuBtn.style.display="none";if(aboutBtn)aboutBtn.style.display="none";const projectTitle=document.getElementById("projectTitle");if(projectTitle)projectTitle.style.cursor="pointer";projectTitle.addEventListener("click",()=>toggleModal("aboutModal",true))}}const uiReady=new Promise(async resolve=>{if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",async()=>{await loadModals();setupModalManager();initGraph();initStatsBar();initializeParameters();blockModalClicks();await loadAboutText();log("UI fully initialized");resolve()})}else{await loadModals();setupModalManager();initGraph();initStatsBar();initializeParameters();blockModalClicks();await loadAboutText();log("UI fully initialized");resolve()}});log(`[${moduleTag(import.meta)}] loaded`);function isMobile(){return/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)}function showLoadingScreen(){let loader=document.getElementById("warmup-loader");if(!loader){loader=document.createElement("div");loader.id="warmup-loader";Object.assign(loader.style,{position:"fixed",inset:"0",background:"rgba(0,0,0,1)",color:"#fff",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"24px",fontFamily:"monospace",zIndex:2e4,flexDirection:"column"});const message=document.createElement("div");message.id="warmup-loader-message";message.style.width="20ch";message.style.textAlign="center";message.textContent="Initializing... 0%";loader.appendChild(message);document.body.appendChild(loader)}loader.style.display="flex"}function updateLoadingMessage(message){const msgEl=document.getElementById("warmup-loader-message");if(msgEl)msgEl.textContent=message}function hideLoadingScreen(){const loader=document.getElementById("warmup-loader");if(loader)loader.style.display="none"}let canvas,ctx;function initCanvas(){canvas=document.getElementById("dslCanvas");if(!canvas){canvas=document.createElement("canvas");canvas.id="dslCanvas";canvas.style.position="fixed";canvas.style.top="0";canvas.style.left="0";canvas.style.zIndex="1";document.body.appendChild(canvas)}ctx=canvas.getContext("2d");function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight}window.addEventListener("resize",resizeCanvas);resizeCanvas();return{canvas:canvas,ctx:ctx}}async function init(){showLoadingScreen();const mobile=isMobile();if(!mobile){setupModalManager();await uiReady;initAttractor();log("Desktop viewer mode")}else{document.body.classList.add("mobile");log("Mobile viewer mode")}const contentElements=Array.from(document.body.children).filter(el=>el.id!=="warmup-loader");contentElements.forEach(el=>el.style.opacity="0");initCanvas();initCanvasRenderer();initSimulationCanvas();startSimulation();let warmupTicks=0;const warmupDuration=30;const checkWarmup=()=>{warmupTicks++;const progress=Math.floor(warmupTicks/warmupDuration*100);updateLoadingMessage(`Initializing... ${progress}%`);if(warmupTicks>=warmupDuration){contentElements.forEach(el=>{el.style.transition="opacity 0.3s";el.style.opacity="1"});hideLoadingScreen();console.log("WELCOME TO DIGITAL SEX LIFE 2025")}else{requestAnimationFrame(checkWarmup)}};requestAnimationFrame(checkWarmup)}document.addEventListener("DOMContentLoaded",async()=>{await init()});export{init,isMobile};
//# sourceMappingURL=dsl.min.js.map